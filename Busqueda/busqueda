
const axios = require('axios').default;
const ipware = require('ipware')().get_ip;
require('dotenv').config();
class Busqueda {
    constructor(req) {
        this.Ip = ''
        this.data = {}
        this.ObtenerIP(req)
    }
    async ObtenerIP(req) {
        const ipInfo = ipware(req);
        const { clientIp } = ipInfo

        if (clientIp != '::1') {
            this.Ip = clientIp
        }
    }


    async ConvertirIpLocation() {


        const response = await axios.get(`https://ipapi.co/${this.Ip}/json/`);
        console.log('Pasa por IPapi')
        const { status } = response //Extraigo primero el status para verificar si esta correcto o no
        if (status != 200) {
            console.log('Debe generar error')
            throw new Error('Falla en la solicitud')
        }

        //Como ya verifique que esta correcto, puedo extraer los datos y devolverlos
        const { data } = response;
        const { ip: IpSolicitud, city: City, latitude: Latitud, longitude: Longitud } = data;
        // const FechaAlta=Date.now()
        this.data = { IpSolicitud, City, Latitud, Longitud }
    }

    async ObtenerClima(req) {
        try {
            const ubicacion = this.ConvertirIpLocation(req)
        } catch (error) {
            return error
        }

        const response = await axios.get(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${process.env.OPM_KEY}`);

    }
}

module.exports = Busqueda;